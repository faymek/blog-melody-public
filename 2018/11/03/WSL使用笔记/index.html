<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="关于WSL的参考博客很多，在此辑录少许，也将自己遇到的坑稍加编撰。"><meta name="keywords" content="WSL"><meta name="author" content="Faymek Feng"><meta name="copyright" content="Faymek Feng"><title>WSL 使用笔记 | Fay Mek</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-132572587-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"H2EEORPJ7G","apiKey":"39dfea676b7fb7a465be02f204e03ded","indexName":"dev_mek","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装过程"><span class="toc-number">2.</span> <span class="toc-text">安装过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装准备"><span class="toc-number">2.1.</span> <span class="toc-text">1. 安装准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-更换软件源并更新软件"><span class="toc-number">2.2.</span> <span class="toc-text">2. 更换软件源并更新软件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-更好用的Terminal"><span class="toc-number">2.3.</span> <span class="toc-text">3. 更好用的Terminal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-桌面环境和X-server"><span class="toc-number">2.4.</span> <span class="toc-text">4. 桌面环境和X-server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-中文输入和显示"><span class="toc-number">2.5.</span> <span class="toc-text">5. 中文输入和显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-管理-wsl-的相关命令"><span class="toc-number">2.6.</span> <span class="toc-text">6. 管理 wsl 的相关命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发环境配置"><span class="toc-number">3.</span> <span class="toc-text">开发环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-zsh-与-oh-my-zsh"><span class="toc-number">3.1.</span> <span class="toc-text">1. zsh 与 oh-my-zsh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Python开发环境"><span class="toc-number">3.2.</span> <span class="toc-text">2. Python开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Jupyter-相关"><span class="toc-number">3.3.</span> <span class="toc-text">3. Jupyter 相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Github添加SSH-key，-git"><span class="toc-number">3.4.</span> <span class="toc-text">4. Github添加SSH key， git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-其他环境"><span class="toc-number">3.5.</span> <span class="toc-text">5. 其他环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#深入讨论"><span class="toc-number">4.</span> <span class="toc-text">深入讨论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装多个发行版"><span class="toc-number">4.1.</span> <span class="toc-text">1. 安装多个发行版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-多种进入-WSL-的方式比较"><span class="toc-number">4.2.</span> <span class="toc-text">3. 多种进入 WSL 的方式比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-与-Windows-的互操作性"><span class="toc-number">4.3.</span> <span class="toc-text">4. 与 Windows 的互操作性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-DrvFs-文件权限问题"><span class="toc-number">4.4.</span> <span class="toc-text">5. DrvFs 文件权限问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-其他关于-WSL-的折腾"><span class="toc-number">4.5.</span> <span class="toc-text">6 其他关于 WSL 的折腾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#踩坑"><span class="toc-number">5.</span> <span class="toc-text">踩坑</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://i.loli.net/2019/01/16/5c3e994227a8a.jpg"></div><div class="author-info__name text-center">Faymek Feng</div><div class="author-info__description text-center">让正确的事情持续发生</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">5</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">朋友们</div><a class="author-info-links__name text-center" href="https://spencerwoo.com/">Spencer Woo</a><a class="author-info-links__name text-center" href="http://element14.site">Mark Huang</a><a class="author-info-links__name text-center" href="https://zhoukay.top/">Benjamin Zhou</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://api.spencerwoo.com)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Fay Mek</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/archives">时间线</a><a class="site-page" href="/tags">内容标签</a><a class="site-page" href="/categories">文章分类</a><a class="site-page" href="/about">关于我</a></span></div><div id="post-info"><div id="post-title">WSL 使用笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/WSL/">WSL</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">5k</span><span class="post-meta__separator">|</span><span>阅读时长: 19 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>关于WSL的参考文章很多，在此辑录少许，也将自己遇到的坑稍加编撰。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><strong>WSL安装过程</strong></p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/24537874" target="_blank" rel="noopener">简明的WSL教程</a></li>
<li><a href="https://zhuanlan.zhihu.com/WindowsSubsystemForLinux" target="_blank" rel="noopener">WSL 使用指南</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/36784160?utm_source=qq&amp;utm_medium=social&amp;utm_oi=614502969539039232" target="_blank" rel="noopener">Windows Subsystem for Linux（WSL）环境下使用图形界面软件</a></li>
<li><a href="https://blessing.studio/wsl-guide/" target="_blank" rel="noopener">WSL 配置指北：打造 Windows 最强命令行</a></li>
</ul>
<p><strong>美化及开发环境配置</strong></p>
<ul>
<li><p><a href="https://spencerwoo.com/dowww/" target="_blank" rel="noopener">Dev on Windows with WSL，在 Windows 上用 WSL 优雅开发</a> </p>
<p>给出了WSL的“最美”实践，见解包括<code>Hyper 终端</code>，<code>VSCode开发环境</code>（ Python 和 C/C++）<code>X-Server</code> 图形界面</p>
</li>
<li><p><a href="https://daverupert.com/2018/04/developing-on-windows-with-wsl-and-visual-studio-code/" target="_blank" rel="noopener">Webdev on Windows with WSL and VS Code</a></p>
<p>WSL+VSCode的开发环境配置，包括Git, Python, Node, Ruby</p>
</li>
<li><p><a href="https://estuarine.jp/2018/07/setup-ubuntu-18-04-wsl/?lang=en" target="_blank" rel="noopener">Setup Ubuntu 18.04 on WSL on Windows 10 Pro</a></p>
</li>
</ul>
<p><strong>设置WSL的默认浏览器为Windows下的Chrome</strong></p>
<ul>
<li><a href="https://www.smslit.top/2017/09/02/wsl-webbrowser/" target="_blank" rel="noopener">WSL(windows subsytem linux)下添加网络浏览器支持</a></li>
<li><a href="http://shallowsky.com/blog/linux/ubuntu-default-browser.html" target="_blank" rel="noopener">Setting the default browser when update-alternatives fails</a></li>
<li><a href="https://blog.csdn.net/qq_41014622/article/details/81515741" target="_blank" rel="noopener">在WSL上调用windows下的chromedriver及chrome浏览器进行自动化测试或爬取网页内容</a></li>
</ul>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>上手两星期有余，更新到Windows 18272之后突然不能开启了，先把WSL复制然后重置了，到WSL的github issue发现这个版本有问题，于是回滚到上个版本。但是系统怎么也恢复不了。无奈，只能再安装一次，顺便写个详细点的日志。</p>
<h3 id="1-安装准备"><a href="#1-安装准备" class="headerlink" title="1. 安装准备"></a>1. 安装准备</h3><ul>
<li>申请Inside 预览计划</li>
</ul>
<p>需要开启开发者模式，不然那可能会出问题，接受不到更新</p>
<ul>
<li>更新并开启WSL服务，去除水印 <a href="http://www.udashi.com/article/11621.html" target="_blank" rel="noopener">http://www.udashi.com/article/11621.html</a></li>
<li>Microsoft Store 安装 Ubuntu，可以不管Ubuntu 18.04那个应用</li>
</ul>
<p>查看当前系统版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br></pre></td></tr></table></figure>
<p>如下等待写作：</p>
<ul>
<li><p>切换用户</p>
</li>
<li><p>卸载wsl</p>
</li>
<li><p><a href="https://www.cnblogs.com/freestylesoccor/p/9630758.html" target="_blank" rel="noopener">WSL下使用VcXsrv启动chromium browser及常见错误解析 (ubuntu18.04， 图形界面)</a></p>
</li>
<li><p>cannot change locale UTF-8 <a href="https://blog.csdn.net/wave_1102/article/details/45116783" target="_blank" rel="noopener">https://blog.csdn.net/wave_1102/article/details/45116783</a></p>
</li>
<li><p>安装桌面环境 xfce gnome tweak 高分屏  <a href="https://zhuanlan.zhihu.com/p/34884285" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34884285</a></p>
</li>
<li><p>不关机重启，查看开机时间 uptime</p>
</li>
<li><p><a href="https://www.cnblogs.com/mushroom/p/8969338.html" target="_blank" rel="noopener">WSL与Windows交互实践</a></p>
</li>
</ul>
<h3 id="2-更换软件源并更新软件"><a href="#2-更换软件源并更新软件" class="headerlink" title="2. 更换软件源并更新软件"></a>2. 更换软件源并更新软件</h3><p>Ubuntu 的软件源配置文件是 <code>/etc/apt/sources.list</code>，我们将其更换为国内软件源，来加快更新的下载速度。打开 <a href="https://link.zhihu.com/?target=https%3A//mirrors.tuna.tsinghua.edu.cn/help/ubuntu/" target="_blank" rel="noopener">清华大学开源软件镜像站</a>，选择自己的Ubuntu版本，得到该文件内容。先备份系统原文件，再创建新文件，即可使用 TUNA 的软件源镜像。Ubuntu命令行输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">sudo touch /etc/apt/sources.list</span><br><span class="line">sudo vi /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 然后将镜像内容粘贴进来保存</span></span><br></pre></td></tr></table></figure>
<p>执行下面代码，更新所需软件，这需要一定时间。如果发现没有联网，可以重启电脑再试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新软件到最新</span></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get --assume-yes upgrade</span><br><span class="line">sudo apt autoremove</span><br></pre></td></tr></table></figure>
<h3 id="3-更好用的Terminal"><a href="#3-更好用的Terminal" class="headerlink" title="3. 更好用的Terminal"></a>3. 更好用的Terminal</h3><p>Windows自带的终端实在惨不忍睹，作为替代，可以使用 <a href="https://goreliu.github.io/wsl-terminal/README.zh_CN.html" target="_blank" rel="noopener">wsl-terminal</a>，简单几步就能有体验原生般的体验。</p>
<ul>
<li><p>快速打开wsl-terminal并进入HOME目录：</p>
<p>新建 <em>wsl-terminal-home-path.bat</em> 文件:</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path\to\your\open-wsl.exe -l</span><br></pre></td></tr></table></figure>
<p>​    建立该文件的快捷方式，更改名称，自定义<a href="https://findicons.com/search/ubuntu" target="_blank" rel="noopener">图标</a>，并将快捷方式放到<code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\</code> 下面，即可通过Win键快速打开，真香！</p>
<p><img src="https://i.loli.net/2018/11/04/5bdf0eb19706f.png" width="75%" height="75%"></p>
<ul>
<li><p>在当前位置通过右键menu启动 WSL</p>
<p>运行wsl-terminal目录下 <code>./tools/1-add-open-wsl-terminal-here-menu.js</code> 就完成了</p>
</li>
<li><p>wsl-terminal更多实用技法</p>
<p>更多用法可以参考其官网说明，或者这位知友的<a href="https://zhuanlan.zhihu.com/p/36784160?utm_source=qq&amp;utm_medium=social&amp;utm_oi=614502969539039232" target="_blank" rel="noopener">专栏文章</a>。</p>
</li>
<li><p>wsl-terminal 使用 zsh 遇到的坑</p>
<p>如果简单的使用 chsh -s /bin/zsh 命令会尴尬的发现 wsl-terminal 启动后还是bash，而wsl原生的shell进入的话就直接是zsh了，这显然是开倒车，令人无法接受。经过折腾发现：执行上面代码后需要将wsl-terminal根目录下 ./etc/wsl-terminal.conf 里的 shell=/bin/bash 改成 shell=/bin/zsh 就好了。</p>
<p>之前所需的环境信息可以放在<code>~/.zshenv</code> 文件里就好了。</p>
</li>
<li><p><strong>terminal 的其他选择</strong></p>
<ul>
<li><a href="https://spencerwoo.com/dowww/2-Toolchain/2-1-TerminalEnv.html#hyper-%E7%BB%88%E7%AB%AF" target="_blank" rel="noopener">Hyper终端</a>，可能是Windows上定制化程度最高的终端</li>
<li><a href="https://link.zhihu.com/?target=http%3A//cmder.net/" target="_blank" rel="noopener">cmder | Console Emulator</a>，同时支持 CMD，Powershell 和 WSL</li>
</ul>
</li>
</ul>
<h3 id="4-桌面环境和X-server"><a href="#4-桌面环境和X-server" class="headerlink" title="4. 桌面环境和X-server"></a>4. 桌面环境和X-server</h3><p>笔者尝试过安装Gnome，以失败告终，此处可以选择轻量级的桌面xfce4，安装所需时间较长：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了xorg，安装下xfce4</span></span><br><span class="line">sudo apt-get install --assume-yes xfce4</span><br><span class="line">sudo apt-get install --assume-yes xorg-dev</span><br></pre></td></tr></table></figure>
<p>因为 WSL 只能是命令行形式的，所以我们需要使用 X-server ，让 Ubuntu 里运行的GUI 程序有窗口显示。可以使用 <a href="https://sourceforge.net/projects/vcxsrv/" target="_blank" rel="noopener">VcXsrv Windows X Server</a>，并以这样的配置打开：</p>
<p><img src="https://i.loli.net/2018/10/01/5bb1c9d292ce0.jpg" alt="img"></p>
<p>输入以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装必要组件</span></span><br><span class="line">sudo apt install libgtk2.0-0 libxss1 libasound2</span><br><span class="line"><span class="comment"># 配置显示参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export DISPLAY=:0.0'</span> &gt;&gt; .profile</span><br><span class="line"><span class="comment"># 测试是否安装成功</span></span><br><span class="line">sudo apt install x11-apps -y &amp;&amp; xeyes</span><br></pre></td></tr></table></figure>
<p>如果出现了跟随鼠标转动的小眼睛，那么 XServer 就安装成功了，能够显示Ubuntu里的GUI程序。</p>
<p>X-server的其他选择</p>
<ul>
<li><a href="https://mobaxterm.mobatek.net/" target="_blank" rel="noopener">MobaXterm</a>，配置可参考知友周敏浩的<a href="https://zhuanlan.zhihu.com/p/36784160?utm_source=qq&amp;utm_medium=social&amp;utm_oi=614502969539039232" target="_blank" rel="noopener">专栏文章</a>。</li>
<li>X410,   对高分屏做了优化，配置可参考知友杨帆的<a href="https://zhuanlan.zhihu.com/p/39446214" target="_blank" rel="noopener">专栏文章</a></li>
</ul>
<h3 id="5-中文输入和显示"><a href="#5-中文输入和显示" class="headerlink" title="5. 中文输入和显示"></a>5. 中文输入和显示</h3><p>在WSL中，Windows文件已经mount在/mnt/下面，我们将Windows的字体文件全部导入到WSL的字体中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将windows的字体放入ubuntu里，并更新缓存</span></span><br><span class="line">sudo mkdir /usr/share/fonts/windows</span><br><span class="line">sudo cp -r /mnt/c/Windows/Fonts/*.ttf /usr/share/fonts/windows/</span><br><span class="line"><span class="built_in">fc</span>-cache</span><br></pre></td></tr></table></figure>
<p>安装中文输入法</p>
<ul>
<li>安装谷歌拼音：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装输入法及所需的包，这里选择谷歌输入法</span></span><br><span class="line">sudo apt-get --assume-yes install fcitx fcitx-googlepinyin dbus-x11</span><br></pre></td></tr></table></figure>
<ul>
<li>设置zh_CN.UTF-8</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo locale-gen zh_CN.UTF-8</span><br></pre></td></tr></table></figure>
<ul>
<li>设置环境变量，将下面代码添加到<code>~/.profile</code>文件里，然后重启下shell。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置中文 &amp; 输入法</span></span><br><span class="line"><span class="built_in">export</span> LC_ALL=<span class="string">"zh_CN.UTF-8"</span></span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=@im=fcitx</span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx</span><br></pre></td></tr></table></figure>
<ul>
<li>中文输入法设置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果运行时长时间卡住，按回车</span></span><br><span class="line">fcitx</span><br><span class="line">fcitx-configtool</span><br></pre></td></tr></table></figure>
<ul>
<li>运行输入法的 GUI 设置工具，通过 <code>+</code> <code>-</code> 调整候选输入法，可选项要至少包含：English(US)和 Google Pinyin。为了不与Windows的快捷键冲突，这里将输入法切换快捷键改成了<code>Ctrl + `</code>：</li>
</ul>
<p><img src="https://i.loli.net/2018/11/04/5bdf06358ce2e.png" width="75%" height="75%"></p>
<p><img src="https://i.loli.net/2018/11/04/5bdf06a02344b.png" width="75%" height="75%"></p>
<p>由于每次开机后启动WSL，默认不会启动dbus 和 fcitx服务，需要设置</p>
<ul>
<li>设置开机启动 dbus 和 fcitx 服务，可以将下面代码添加到<code>~/.bashrc</code>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ $(ps -ax | grep dbus-daemon | wc -l) -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">eval</span> `dbus-launch fcitx &gt; /dev/null 2&gt;&amp;1`</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>如果仍出现无法输入中文的情况，则在shell内手动输入以下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果用的是 zsh，则将 bash 改成 zsh</span></span><br><span class="line">dbus-run-session -- bash</span><br><span class="line">fcitx</span><br></pre></td></tr></table></figure>
<h3 id="6-管理-wsl-的相关命令"><a href="#6-管理-wsl-的相关命令" class="headerlink" title="6. 管理 wsl 的相关命令"></a>6. 管理 wsl 的相关命令</h3><p>在 cmd / PowerShell 中运行 wsl , bash, Linux系统名称（如 ubuntu），即可进入 Linux 系统。</p>
<p>以下命令都是在cmd / powershell 下运行来管理子系统：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 设置默认运行的linux系统</span><br><span class="line">wslconfig /setdefault &lt;DistributionName&gt;</span><br><span class="line">// 卸载linux系统</span><br><span class="line">wslconfig /unregister &lt;DistributionName&gt;</span><br><span class="line">// 查看已安装的linux系统</span><br><span class="line">wslconfig /list</span><br><span class="line">// 设置默认登陆用户</span><br><span class="line">ubuntu config --default-user root</span><br></pre></td></tr></table></figure>
<p>如果WSL损坏，可以把子系统删了重来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> // 删除 Ubuntu 子系统</span><br><span class="line">wslconfig /unregister Ubuntu</span><br></pre></td></tr></table></figure>
<h2 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h2><h3 id="1-zsh-与-oh-my-zsh"><a href="#1-zsh-与-oh-my-zsh" class="headerlink" title="1. zsh 与 oh-my-zsh"></a>1. zsh 与 oh-my-zsh</h3><p>想要快乐地使用命令行，一个趁手的 Shell 是必不可少的。</p>
<ul>
<li><p>下载安装 <code>zsh</code> 代替自动补全功能欠缺的 <code>bash</code>：</p>
<p>利用 Ubuntu 的包管理器安装 <code>zsh</code>：<code>sudo apt install zsh</code></p>
<p>修改 <code>.bashrc</code> 加入以下代码，使得默认 <code>shell</code> 变成 <code>zsh</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -t 1 ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">exec</span> zsh</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>加载设置：<code>source ~/.bashrc</code></p>
</li>
<li><p>下载安装 <a href="https://ohmyz.sh/" target="_blank" rel="noopener"><code>oh-my-zsh</code></a>，一个好用的 <code>zsh</code> 配置管理工具：</p>
<p>运行命令下载安装：<code>sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</code> （提醒没有什么就安装什么。）</p>
</li>
<li><p>去除 <code>ls</code> 和 <code>cd</code> 命令之后背景色出现的问题：</p>
<p>修改 <code>.zshrc</code>，添加如下代码</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Change ls colours</span></span><br><span class="line">LS_COLORS=<span class="string">"ow=01;36;40"</span> &amp;&amp; <span class="built_in">export</span> LS_COLORS</span><br><span class="line"></span><br><span class="line"><span class="comment"># make cd use the ls colours</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">':completion:*'</span> list-colors <span class="string">"<span class="variable">$&#123;(@s.:.)LS_COLORS&#125;</span>"</span></span><br><span class="line"><span class="built_in">autoload</span> -Uz compinit</span><br><span class="line">compinit</span><br></pre></td></tr></table></figure>
<p>加载设置：<code>source ~/.zshrc</code></p>
<p>基本的终端环境就到这里了。</p>
<h3 id="2-Python开发环境"><a href="#2-Python开发环境" class="headerlink" title="2. Python开发环境"></a>2. Python开发环境</h3><p><a href="https://stackoverflow.com/questions/45421163/anaconda-vs-miniconda" target="_blank" rel="noopener">选择 MiniConda 还是 Anaconda ？</a> <code>conda</code> 是包管理工具，<code>miniconda</code> 发行版在此基础上捆绑了少量的包，<code>anaconda</code> 发行版则捆绑了足量的包，此处可以按照个人需求选择。</p>
<ul>
<li>安装 Miniconda，一路 Enter ，最后一步选 <code>yes</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh</span><br></pre></td></tr></table></figure>
<ul>
<li>换国内镜像源？</li>
</ul>
<blockquote>
<p>(2019.05.28 更新）目前国内大多数Anaconda镜像源已经挂掉，如果您之前使用的第三方镜像停止服务，请换回官方镜像。更多帮助信息，可参考 <a href="https://zhuanlan.zhihu.com/p/64766956" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/64766956</a><br>此外，上海交通大学镜像源的Anaconda镜像对校内IP开放：<a href="https://mirrors.sjtug.sjtu.edu.cn/#/" target="_blank" rel="noopener">https://mirrors.sjtug.sjtu.edu.cn/#/</a></p>
</blockquote>
<ul>
<li><p>（可选）如需更改默认环境的Python版本，使用<code>conda install python=3.6</code></p>
</li>
<li><p>接下来更新包：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda update conda</span><br><span class="line">conda update --all</span><br></pre></td></tr></table></figure>
<ul>
<li>安装常用包</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install jupyter notebook pandas matplotlib numpy scipy</span><br></pre></td></tr></table></figure>
<p>设置 pip 源</p>
<ul>
<li>修改 <code>~/.pip/pip.conf</code>，没有就先创建文件夹及文件：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.pip</span><br><span class="line">vim ~/.pip/pip.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>加入如下内容：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure>
<h3 id="3-Jupyter-相关"><a href="#3-Jupyter-相关" class="headerlink" title="3. Jupyter 相关"></a>3. Jupyter 相关</h3><p><code>Jupyter notebook</code> / <code>JupyterLab</code>启动相关</p>
<p>安装体验 JupyterLab ： <code>conda install -c conda-forge jupyterlab</code> 或者 <code>pip install jupyterlab</code></p>
<p>使用X-server打开WSL内置的FireFox浏览器，交互上可能不太便捷，个别X-server可能会出现按键连续响应的情况，可以用如下方法在Windows 下的浏览器中打开。先让jupyter运行在无浏览器模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --no-browser</span><br><span class="line">jupyter lab --no-browser</span><br></pre></td></tr></table></figure>
<p>然后在你的Terminal里点击链接，就是用Windows下的浏览器打开了。（要点击斜杠位置哦 :computer_mouse: ，这样才能识别完整的链接）。当然你也可以更改wsl的默认浏览器为Windows下的浏览器，这里就不赘述了。</p>
<p>为了启动方便，可以在<code>~/.bashrc</code>里设置别名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> jnote=<span class="string">'jupyter notebook --no-browser'</span></span><br><span class="line"><span class="built_in">alias</span> jlab=<span class="string">'jupyter lab --no-browser'</span></span><br></pre></td></tr></table></figure>
<p>链接Windows下的Matlab</p>
<p>此处要注意matlab的版本支持问题，MatlabR2018b版本支持Python 2.7, 3.5, 3.6，如你使用3.7版本，可以通过如下方法魔改：<a href="https://jingyan.baidu.com/article/4853e1e5b962ac1909f726ea.html" target="_blank" rel="noopener">Jupyter Notebook(Python3.7)如何支持MATLAB？</a></p>
<ul>
<li>在wsl侧安装matlab_kernel ：<code>pip install matlab_kernel</code></li>
<li>在Windows侧打开matlab安装的如下位置：<code>MATLAB版本号/extern/engines/python</code>，在此处打开wsl-terminal</li>
<li>运行：<code>python setup.py install</code></li>
<li>在Jupyter下就能看到啦，但是提示 No kernel 无法运行，待解决 :sob:</li>
</ul>
<blockquote>
<p>OSError: Please reinstall MATLAB Engine for Python or contact MathWorks Technical Support for assistance: No module named ‘matlabengineforpython3_6’</p>
<p>matlab-kernel         0.15.2<br>matlabengineforpython R2018a</p>
<p>可能是需要魔改一番了。</p>
</blockquote>
<p>如何卸载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setup.py 帮助你纪录安装细节方便你卸载</span><br><span class="line">python setup.py install --record <span class="built_in">log</span></span><br><span class="line">这时所有的安装细节都写到 <span class="built_in">log</span> 里了</span><br><span class="line">想要卸载的时候</span><br><span class="line">cat <span class="built_in">log</span> | xargs rm -rf</span><br><span class="line">就可以干净卸载了</span><br><span class="line">vi dist/matlab/engine/__init__.py</span><br></pre></td></tr></table></figure>
<p>然而 pip 安装包的名字是<code>matlabengineforpython3-6</code>，根本不可能</p>
<p>matlabengineforpython</p>
<p>想法是错的，原dist在windows可以跑，应该是架构的问题</p>
<ol>
<li>调用windows下的python</li>
<li>找出importlib的工作机理</li>
</ol>
<p>凉凉呀</p>
<p>调试了两天，发现是自己解决不了的问题，<code>matlabengineforpython3-6.pyd</code>文件是.dll，对于linux下的.so文件，怎么能让import调用呢，没时间考虑了。</p>
<h3 id="4-Github添加SSH-key，-git"><a href="#4-Github添加SSH-key，-git" class="headerlink" title="4. Github添加SSH key， git"></a>4. Github添加SSH key， git</h3><p><a href="https://help.github.com/articles/connecting-to-github-with-ssh/" target="_blank" rel="noopener">https://help.github.com/articles/connecting-to-github-with-ssh/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br><span class="line">clip &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>
<p>github <a href="https://github.com/settings/ssh/new" target="_blank" rel="noopener">https://github.com/settings/ssh/new</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email <span class="string">"you@example.com"</span></span><br><span class="line">git config --global user.name <span class="string">"Your Name"</span></span><br></pre></td></tr></table></figure>
<h3 id="5-其他环境"><a href="#5-其他环境" class="headerlink" title="5. 其他环境"></a>5. 其他环境</h3><ul>
<li>Installing Node</li>
</ul>
<p>如果你使用zsh,请替换为.zshrc</p>
<p>Node is almost as easy to install, let’s use <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener"><code>nvm</code></a> for that inevitable day where we have to support mutliple versions of Node.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.9/install.sh | bash</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">nvm install --lts</span><br></pre></td></tr></table></figure>
<p>You should now have <code>node</code> and <code>npm</code> installed.</p>
<ul>
<li>Installing Ruby and Rails</li>
</ul>
<p>Ruby has a few more dependencies. Thankfully WSL has improved so that we can follow any generic “How to Install Ruby on Rails” tutorial, I like this one from <a href="https://www.digitalocean.com/community/tutorials/how-to-install-ruby-on-rails-with-rbenv-on-ubuntu-16-04" target="_blank" rel="noopener">Digital Ocean</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install autoconf bison build-essential libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libncurses5-dev libffi-dev libgdbm3 libgdbm-dev</span><br><span class="line">git clone https://github.com/rbenv/rbenv.git ~/.rbenv</span><br><span class="line">echo &apos;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &apos;eval &quot;$(rbenv init -)&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line">git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build</span><br><span class="line">rbenv install 2.5.1 --verbose</span><br><span class="line">rbenv global 2.5.1</span><br><span class="line">echo &quot;gem: --no-document&quot; &gt; ~/.gemrc</span><br><span class="line">gem install bundler</span><br><span class="line">gem install rails</span><br></pre></td></tr></table></figure>
<p>You don’t technically need <code>--verbose</code> for installing Ruby via <code>rbenv</code>, but having some progress indicator helps with your sense of <a href="http://lawsofsimplicity.com/los/law-3-time.html" target="_blank" rel="noopener">time</a>.</p>
<h2 id="深入讨论"><a href="#深入讨论" class="headerlink" title="深入讨论"></a>深入讨论</h2><h3 id="1-安装多个发行版"><a href="#1-安装多个发行版" class="headerlink" title="1. 安装多个发行版"></a>1. 安装多个发行版</h3><p>Windows 10 Fall Creators Update 之后，WSL 支持同时安装多个 Linux 发行版，直接在 Microsoft Store 中搜索想要的发行版并点击安装即可。这些发行版可以同时运行，并且数据互相独立。你可以使用 <code>wslconfig.exe</code> 来查询已安装的发行版，或者更改默认的发行版。</p>
<h3 id="3-多种进入-WSL-的方式比较"><a href="#3-多种进入-WSL-的方式比较" class="headerlink" title="3. 多种进入 WSL 的方式比较"></a>3. 多种进入 WSL 的方式比较</h3><p>新版支持同时安装多个发行版，那自然不能像以前那样只提供一个 <code>bash.exe</code> 入口了。</p>
<p>秋季创意者更新之后的 Windows 提供了 <a href="https://blogs.msdn.microsoft.com/commandline/2017/11/28/a-guide-to-invoking-wsl/" target="_blank" rel="noopener">多种进入 WSL 环境的方式</a>：</p>
<ul>
<li><p><code>wsl.exe</code></p>
<p>打开<strong>默认</strong>发行版中的默认 Shell。</p>
</li>
<li><p><code>&lt;distroname&gt;.exe</code></p>
<p>打开<strong>指定</strong>发行版中的默认 Shell。</p>
</li>
<li><p><code>bash.exe</code> (DEPRECATED)</p>
<p>打开<strong>默认</strong>发行版中的 <strong>bash</strong> Shell。</p>
<p>如果你更改了默认 Shell 却总是打开 bash，就说明你使用了这个入口。</p>
</li>
</ul>
<p>你也可以通过这些入口直接在 WSL 中执行命令并返回结果：</p>
<ul>
<li><code>&lt;distroname&gt; -c [command]</code></li>
<li><code>bash -c [command]</code></li>
<li><code>wsl [command]</code>（不再需要指定 <code>-c</code>）</li>
</ul>
<h3 id="4-与-Windows-的互操作性"><a href="#4-与-Windows-的互操作性" class="headerlink" title="4. 与 Windows 的互操作性"></a>4. 与 Windows 的互操作性</h3><p>WSL 与 Windows 之间的互操作性 (Interoperability) 很牛逼。怎么个牛逼法呢？</p>
<p>Windows 下的所有盘符都挂载在 WSL 中的 <code>/mnt</code> 目录下，可以直接操作。WSL 中的所有数据则存放于 <code>C:\Users\{你的用户名}\AppData\Local\Packages\{Linux发行版包名}\LocalState\rootfs</code> 目录中（不要在 Windows 中修改这些文件，这会造成文件权限错误）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls /mnt</span><br><span class="line">c  d  e</span><br><span class="line">$ mount -l</span><br><span class="line">rootfs on / type lxfs (rw,noatime)</span><br><span class="line">C: on /mnt/c type drvfs (rw,noatime,uid=1000,gid=1000)</span><br><span class="line">D: on /mnt/d type drvfs (rw,noatime,uid=1000,gid=1000)</span><br><span class="line">E: on /mnt/e type drvfs (rw,noatime,uid=1000,gid=1000)</span><br></pre></td></tr></table></figure>
<p>你可以在 Windows 命令行环境中直接调用 WSL 中的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\temp&gt; wsl ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxrwxrwx 1 printempw printempw 4096 Sep  7 19:04 .</span><br><span class="line">drwxrwxrwx 1 printempw printempw 4096 Sep  7 18:38 ..</span><br><span class="line">-rwxrwxrwx 1 printempw printempw    4 Sep  7 19:04 foo.txt</span><br></pre></td></tr></table></figure>
<p>你也可以在 WSL 中调用 Windows 中的命令行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ which ipconfig.exe</span><br><span class="line">/mnt/c/Windows/System32/ipconfig.exe</span><br><span class="line">$ ipconfig.exe</span><br><span class="line">Windows IP Configuration</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>你可以在 WSL 中直接启动 Windows 应用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ notepad.exe &quot;C:\temp\foo.txt&quot;</span><br></pre></td></tr></table></figure>
<p>你还可以通过 pipes 与 Windows 程序通信：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 复制内容至 Windows 剪贴板</span><br><span class="line">$ cat foo.txt | clip.exe</span><br></pre></td></tr></table></figure>
<p>你甚至可以把 Windows 命令和 WSL 命令混着用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; ipconfig | wsl grep IPv4</span><br><span class="line">IPv4 Address. . . . . . . . . . . : 192.168.1.114</span><br><span class="line"></span><br><span class="line">$ ipconfig.exe | grep IPv4 | cut -d: -f2</span><br><span class="line">192.168.1.114</span><br><span class="line"></span><br><span class="line">$ ls -al | findstr.exe foo.txt</span><br><span class="line">-rwxrwxrwx 1 printempw printempw    4 Sep  7 19:04 foo.txt</span><br><span class="line"></span><br><span class="line">$ cmd.exe /c dir</span><br><span class="line"> Volume in drive C is Windows</span><br><span class="line"> Volume Serial Number is B263-****</span><br><span class="line"></span><br><span class="line"> Directory of C:\temp</span><br><span class="line"></span><br><span class="line">2018/09/07  19:04    &lt;DIR&gt;          .</span><br><span class="line">2018/09/07  19:04    &lt;DIR&gt;          ..</span><br><span class="line">2018/09/07  19:04                 4 foo.txt</span><br><span class="line">               1 File(s)              4 bytes</span><br><span class="line">               2 Dir(s)  194,422,341,632 bytes free</span><br></pre></td></tr></table></figure>
<p>同时，WSL 与 Windows 共享网络栈，也就是说你可以：</p>
<ul>
<li>在 WSL 中启动 web server，在 Windows 上使用浏览器访问；</li>
<li>在 Windows 下启动 MySQL/Redis 服务器，在 WSL 中连接；</li>
<li>诸如此类。</li>
</ul>
<p>如果你对 WSL 与 Windows 之间互操作的原理有兴趣，可以参考一下这些文章：</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/wsl/interop" target="_blank" rel="noopener">WSL interoperability with Windows</a></li>
<li><a href="https://blogs.msdn.microsoft.com/wsl/2016/10/19/windows-and-ubuntu-interoperability/" target="_blank" rel="noopener">Windows and Ubuntu Interoperability</a></li>
</ul>
<h3 id="5-DrvFs-文件权限问题"><a href="#5-DrvFs-文件权限问题" class="headerlink" title="5. DrvFs 文件权限问题"></a>5. DrvFs 文件权限问题</h3><p>虽然 WSL 中可以直接访问 Windows 磁盘的内容，但如果你曾经这么做过，你应该对这样绿油油一片的 <code>ls</code> 不会感到陌生。为什么 NTFS 文件系统中的文件到 WSL 下权限就全部成 <code>0777</code> 了呢？</p>
<p><a href="https://img.blessing.studio/images/2018/09/08/ls-with-wrong-file-permission.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2018/09/08/ls-with-wrong-file-permission.png" alt="ls-with-wrong-file-permission"></a></p>
<p>这主要是 DrvFs 中 Linux 文件权限的实现导致的。</p>
<p>在 WSL 中，<a href="https://blogs.msdn.microsoft.com/wsl/2016/06/15/wsl-file-system-support/" target="_blank" rel="noopener">Microsoft 实现了两种文件系统</a>，用于支持不同的使用场景：</p>
<ul>
<li><p><strong>VolFs</strong></p>
<p>着力于在 Windows 文件系统上提供完整的 Linux 文件系统特性，通过各种手段实现了对 Inodes、Directory entries、File objects、File descriptors、Special file types 的支持。比如为了支持 Windows 上没有的 Inodes，VolFs 会把文件权限等信息保存在文件的 NTFS Extended Attributes 中。记得我上面警告过你不要在 Windows 中修改 WSL 里的文件吗？就是因为 Windows 中新建的文件缺少这个扩展参数，VolFs 无法正确获取该文件的 metadata，而且有些 Windows 上的编辑器会在保存时抹掉这些附加参数。</p>
<p>WSL 中的 <code>/</code> 使用的就是 VolFs 文件系统。</p>
</li>
<li><p><strong>DrvFs</strong></p>
<p>着力于提供与 Windows 文件系统的互操作性。与 VolFs 不同，为了提供最大的互操作性，DrvFs 不会在文件的 NTFS Extended Attributes 中储存附加信息，而是从 Windows 的文件权限（Access Control Lists，就是你右键文件 &gt; 属性 &gt; 安全选项卡中的那些权限配置）推断出该文件对应的的 Linux 文件权限。</p>
<p>所有 Windows 盘符挂载至 WSL 下的 <code>/mnt</code> 时都是使用的 DrvFs 文件系统。</p>
</li>
</ul>
<p>由于 DrvFs 的文件权限继承机制很微妙，最后导致的结果就是所有文件的权限都变成了 <code>0777</code>。而且由于早期的 DrvFs 不支持 metadata，所以你无法给这些文件 chown/chmod，只能对着绿油油的 <code>ls</code> 干瞪眼。不过好消息是，Windows Insider Build 17063 之后，<a href="https://blogs.msdn.microsoft.com/commandline/2018/01/12/chmod-chown-wsl-improvements/" target="_blank" rel="noopener">DrvFs 也像 VolFs 一样支持给文件写入 metadata 了</a>。</p>
<p>要启用 DrvFs 的 metadata 支持，你需要添加参数重新挂载磁盘：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 修改成你自己的盘符</span><br><span class="line">$ sudo umount /mnt/e</span><br><span class="line">$ sudo mount -t drvfs E: /mnt/e -o metadata</span><br></pre></td></tr></table></figure>
<p>不过如果仅仅是执行了这个，虽然支持了文件权限的修改，但磁盘下的文件权限默认依然还是 <code>0777</code>，除非你给它们整个 <code>chmod</code> 一遍。如果你不想这么做，也可以指定其他的 mount 参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mount -t drvfs E: /mnt/e -o metadata,uid=1000,gid=1000,umask=22,fmask=111</span><br></pre></td></tr></table></figure>
<p>这样磁盘下的文件的默认权限就是 <code>0644</code>，<code>ls</code> 也不会再是绿油油一片啦。</p>
<p><a href="https://img.blessing.studio/images/2018/09/08/ls-with-fixed-file-permission.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2018/09/08/ls-with-fixed-file-permission.png" alt="ls-with-fixed-file-permission"></a></p>
<p>不过每次使用时都要重新挂载未免也太烦，我们可以通过另一个新特性 <a href="https://blogs.msdn.microsoft.com/commandline/2018/02/07/automatically-configuring-wsl/" target="_blank" rel="noopener">Automatically Configuring WSL</a>实现自动挂载。在 WSL 中创建 <code>/etc/wsl.conf</code>，在其中填写如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[automount]</span><br><span class="line">enabled = true</span><br><span class="line">root = /mnt/</span><br><span class="line">options = &quot;metadata,umask=22,fmask=111&quot;</span><br><span class="line">mountFsTab = true</span><br><span class="line"></span><br><span class="line"># 这个文件里还可以添加其他配置项，有兴趣的可以看看上面的链接</span><br></pre></td></tr></table></figure>
<p>重启终端，所有的盘符就会使用上面的配置自动挂载啦（可以使用 <code>mount -l</code> 查看）。</p>
<p>另外，如果你想要给不同的盘符设定不同的挂载参数（上面的方法对所有盘符都有效，如果你想在 WSL 中运行 Windows 下的应用程序，就得每次都 <code>chmod +x</code> 一下，所以我一般都会把 <code>C:</code> 排除掉），就需要手动修改 <code>/etc/fstab</code>。首先确保 <code>wsl.conf</code> 中的 <code>mountFsTab</code> 为 <code>true</code>，然后编辑 <code>/etc/fstab</code>，添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 不在此列表中的盘符会使用 wsl.conf 中的参数挂载</span><br><span class="line"># 格式可以自己去查 fstab 的帮助文档</span><br><span class="line">E: /mnt/e drvfs rw,relatime,uid=1000,gid=1000,metadata,umask=22,fmask=111 0 0</span><br></pre></td></tr></table></figure>
<h3 id="6-其他关于-WSL-的折腾"><a href="#6-其他关于-WSL-的折腾" class="headerlink" title="6 其他关于 WSL 的折腾"></a>6 其他关于 WSL 的折腾</h3><p>虽然 Microsoft 开发 WSL 出来主要是着重于命令行环境的使用，但经过测试，WSL 是可以通过 X Server 执行 GUI 应用程序的，<a href="https://news.ycombinator.com/item?id=13603451" target="_blank" rel="noopener">甚至还可以在 WSL 里面用 Wine 执行 Windows 程序</a>……（🤔？）</p>
<p>也有人试过在 WSL 中运行完整的 DE，体验似乎还不错，有兴趣的同学可以去试试。</p>
<p>另外，你也可以通过某些神秘的方法用上 Microsoft Store 未提供的 Linux 发行版，比如 <a href="https://wiki.archlinux.org/index.php/Install_on_WSL_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" target="_blank" rel="noopener">Arch Linux</a>。</p>
<p>如果你对 WSL 的底层实现有兴趣，也可以去围观一下 WSL 的官方博客：</p>
<ul>
<li><a href="https://blogs.msdn.microsoft.com/wsl/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/wsl/</a></li>
<li><a href="https://blogs.msdn.microsoft.com/commandline/tag/wsl/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/commandline/tag/wsl/</a></li>
</ul>
<h2 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h2><p>在此列举我遇到的一些问题，大部分还没解决。大家遇到问题时可以先到wsl的github issue 搜索。</p>
<ul>
<li>Ubuntu18.04 配置Gnome桌面环境失败</li>
<li>wsl 中 chrome 无法运行</li>
<li>jupyter notebook 与 selenium 无法同时使用chrome</li>
<li>jekyll 没问题</li>
<li>如何备份系统</li>
<li>WSL与Windows的时差</li>
</ul>
<p>使用该命令显示错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-local-rtc 1 --adjust-system-clock</span><br></pre></td></tr></table></figure>
<p>换用如下命令，把时区调整到<code>Asia / Shanghai</code>就好</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure tzdata</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Faymek Feng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://faymek.github.io/2018/11/03/WSL使用笔记/">https://faymek.github.io/2018/11/03/WSL使用笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://faymek.github.io">Fay Mek</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WSL/">WSL</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/07/02/小程序后端开发记录/"><i class="fa fa-chevron-left">  </i><span>小程序后端开发记录</span></a></div><div class="next-post pull-right"><a href="/2018/07/31/解决Coursera国内速度慢的问题/"><span>解决Coursera国内速度慢的问题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://api.spencerwoo.com)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Faymek Feng</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>